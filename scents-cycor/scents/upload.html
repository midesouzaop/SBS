<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Upload de Arquivo</title>
</head>
<body>

<h1>Upload de Imagem, GIF ou Vídeo</h1>

<form id="uploadForm">
    <input type="file" id="media" name="media" accept="image/*,video/*" required>
    <button type="submit">Enviar</button>
</form>

<div id="message"></div>

<script>
document.getElementById('uploadForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    const fileInput = document.getElementById('media');
    const file = fileInput.files[0];
    const messageDiv = document.getElementById('message');

    if (!file) {
        messageDiv.innerText = 'Nenhum arquivo selecionado.';
        return;
    }

    // Verificar tamanho mínimo de 32MB
    if (file.size < (32 * 1024 * 1024)) {
        messageDiv.innerText = 'O arquivo é muito pequeno. O mínimo é 32MB.';
        return;
    }

    // Se for vídeo, verificar duração
    if (file.type.startsWith('video/')) {
        const video = document.createElement('video');
        video.preload = 'metadata';

        video.onloadedmetadata = function() {
            window.URL.revokeObjectURL(video.src);

            if (video.duration > 30) {
                messageDiv.innerText = 'O vídeo excede 30 segundos.';
                return;
            }

            // Se passou, faz upload
            sendFile(file);
        };

        video.src = URL.createObjectURL(file);
    } else {
        // Se não for vídeo, faz upload direto
        sendFile(file);
    }
});

async function sendFile(file) {
    const formData = new FormData();
    formData.append('media', file);

    try {
        const response = await fetch('/upload', {
            method: 'POST',
            body: formData,
            headers: {
                'Authorization': 'Bearer seu_token_aqui'  // ajuste seu token
            }
        });

        const result = await response.json();
        document.getElementById('message').innerText = result.message || result.detail;
    } catch (error) {
        console.error('Erro:', error);
        document.getElementById('message').innerText = 'Erro ao fazer upload.';
    }
}
</script>

</body>
</html>
